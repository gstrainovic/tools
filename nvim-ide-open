#!/bin/bash
# nvim-ide-open — Öffnet Datei im laufenden nvim-Server (für yazi)
# Funktioniert unter Linux und Windows (Git Bash)

if [[ "$OS" == "Windows_NT" ]]; then
    SOCKET='\\.\pipe\nvim-ide'
else
    SOCKET="/tmp/nvim-ide.sock"
fi

if nvim --server "$SOCKET" --remote-expr "1" &>/dev/null; then
    nvim --server "$SOCKET" --remote "$@"
else
    # Server nicht erreichbar → Fallback mit Warnung
    echo "⚠️  nvim-Server nicht erreichbar ($SOCKET)" >&2
    echo "   Öffne lokal statt via RPC..." >&2
    nvim "$@"
fi
